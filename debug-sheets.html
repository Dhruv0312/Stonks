<!DOCTYPE html>
<html>
<head>
    <title>Google Sheets Debug Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .sheet { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        .success { background: #e6ffe6; border-color: #4CAF50; }
        .error { background: #ffe6e6; border-color: #f44336; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .column-header { background: #e3f2fd; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Google Sheets Debug Tool</h1>
    <div id="results"></div>
    
    <script>
        const API_KEY = 'AIzaSyBANy06jI96BJZYS5PBhrhK3bhoNsfWwZ0';
        const SPREADSHEET_ID = '10F2ON8N3phmbvKQNQFfKet44XoytFxA3SgUiIlHl6VY';
        
        async function debugSheets() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Fetching data from all sheets...</p>';
            
            const sheets = [
                { name: 'Watchlist', expected: ['Symbol', 'Name', 'Sector', 'Price', 'Change', 'Change%', 'Market Cap'] },
                { name: 'Latest RSI', expected: ['Symbol', 'RSI'] },
                { name: 'Latest MACD', expected: ['Symbol', 'MACD', 'Signal', 'Histogram'] }
            ];
            
            for (const sheet of sheets) {
                try {
                    const response = await fetch(
                        `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(sheet.name)}!A:Z?key=${API_KEY}`
                    );
                    
                    if (!response.ok) {
                        resultsDiv.innerHTML += `
                            <div class="sheet error">
                                <h3>${sheet.name} - Error ${response.status}</h3>
                                <p>Failed to fetch data</p>
                            </div>
                        `;
                        continue;
                    }
                    
                    const data = await response.json();
                    
                    if (data.values && data.values.length > 0) {
                        const headers = data.values[0];
                        const rows = data.values.slice(1);
                        
                        resultsDiv.innerHTML += `
                            <div class="sheet success">
                                <h3>${sheet.name}</h3>
                                <p><strong>Total Rows:</strong> ${data.values.length} (${rows.length} data rows)</p>
                                <p><strong>Columns:</strong> ${headers.length}</p>
                                
                                <h4>Headers (First Row):</h4>
                                <table>
                                    <tr class="column-header">
                                        ${headers.map((header, index) => `<th>Column ${index}</th>`).join('')}
                                    </tr>
                                    <tr>
                                        ${headers.map(header => `<td>${header || '(empty)'}</td>`).join('')}
                                    </tr>
                                </table>
                                
                                <h4>First 5 Data Rows:</h4>
                                <table>
                                    <tr class="column-header">
                                        ${headers.map((header, index) => `<th>${header || `Col ${index}`}</th>`).join('')}
                                    </tr>
                                    ${rows.slice(0, 5).map(row => `
                                        <tr>
                                            ${row.map(cell => `<td>${cell || '(empty)'}</td>`).join('')}
                                        </tr>
                                    `).join('')}
                                </table>
                                
                                <h4>Expected vs Actual:</h4>
                                <p><strong>Expected:</strong> ${sheet.expected.join(', ')}</p>
                                <p><strong>Actual:</strong> ${headers.join(', ')}</p>
                            </div>
                        `;
                    } else {
                        resultsDiv.innerHTML += `
                            <div class="sheet error">
                                <h3>${sheet.name}</h3>
                                <p>No data found</p>
                            </div>
                        `;
                    }
                    
                } catch (error) {
                    resultsDiv.innerHTML += `
                        <div class="sheet error">
                            <h3>${sheet.name} - Network Error</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }
        }
        
        debugSheets();
    </script>
</body>
</html> 